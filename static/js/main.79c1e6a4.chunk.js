(this.webpackJsonpplaylist_rec=this.webpackJsonpplaylist_rec||[]).push([[0],{101:function(e,t,a){"use strict";var n=a(0),o=a.n(n);a(140);t.a=function(e){var t=e.dataUri,a=e.isFullscreen?"demo-image-preview-fullscreen":"";return o.a.createElement("div",{className:"demo-image-preview "+a},o.a.createElement("img",{src:t}))}},104:function(e,t,a){e.exports=a(212)},109:function(e,t,a){},112:function(e,t,a){},140:function(e,t,a){},169:function(e,t){},171:function(e,t){},196:function(e,t){},212:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(23),r=a.n(i),s=(a(109),a(90));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(s.a,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},90:function(e,t,a){"use strict";(function(e){var n=a(26),o=a(91),i=a(92),r=a(103),s=a(93),c=a(6),l=a(102),u=a(0),m=a.n(u),g=(a(112),a(113),a(94)),h=a.n(g),d=(a(114),a(95)),p=(a(128),a(98)),f=a.n(p),b=a(100),y=a.n(b),v=a(101),P=a(141),k=function(t){function a(e,t){var n;return Object(o.a)(this,a),(n=Object(r.a)(this,Object(s.a)(a).call(this,e,t))).state={backgroundImage:"",azureKey:"1de04c834f214ba9b444ab120cb2ab1a",dataUri:null,loading:!1,emotion:n.props.emotion,isHappy:!0,age:20,loadSong:!1,opts:{height:"800px",width:"960px",playerVars:{autoplay:1,list:"PLmS86t_jmQvbpeehASz2Tosvj7d1VN-ZE",playsinline:1,modestbranding:1,index:10,controls:0}}},n.onSelectImage=n.onSelectImage.bind(Object(c.a)(n)),n.onTakePhotoAnimationDone=n.onTakePhotoAnimationDone.bind(Object(c.a)(n)),n.getAgeAndEmotion=n.getAgeAndEmotion.bind(Object(c.a)(n)),n.getRecs=n.getRecs.bind(Object(c.a)(n)),n.getMusicYearFromAge=n.getMusicYearFromAge.bind(Object(c.a)(n)),n.isThisEmotionHappy=n.isThisEmotionHappy.bind(Object(c.a)(n)),n.getPlaylistFromParams=n.getPlaylistFromParams.bind(Object(c.a)(n)),n.getBackgroundImage=n.getBackgroundImage.bind(Object(c.a)(n)),n}return Object(l.a)(a,t),Object(i.a)(a,[{key:"onTakePhotoAnimationDone",value:function(e){var t=this;this.setState({dataUri:e,loading:!0}),Promise.all([this.getAgeAndEmotion()]).then((function(e){var a=Object(n.a)(e,1),o=Object(n.a)(a[0],2),i=o[0],r=o[1];t.setState({age:i,emotion:r}),t.getRecs()})).then((function(){Promise.all([t.getBackgroundImage()]).then((function(e){var a=Object(n.a)(e,1)[0];t.setState({backgroundImage:a,loading:!1,loadSong:!0})})).catch((function(){console.log("backgroundImage promise err")}))}))}},{key:"onSelectImage",value:function(){this.setState({loadSong:!0})}},{key:"getAgeAndEmotion",value:function(){var t=this;return new Promise((function(a,n){var o=-1,i=null,r=t.state.azureKey,s=new e(t.state.dataUri.replace(/^data:image\/(png|gif|jpeg);base64,/,""),"base64");fetch("https://southcentralus.api.cognitive.microsoft.com/face/v1.0/detect?returnFaceId=false&returnFaceLandmarks=false&returnFaceAttributes=age,emotion",{method:"post",body:s,headers:{"Content-Type":"application/octet-stream","Ocp-Apim-Subscription-Key":r}}).then((function(e){return e.json()})).then((function(e){console.log(e),e.length>0?(o=e[0].faceAttributes.age,i=e[0].faceAttributes.emotion,console.log("Azure: age = "+o),console.log("Azure: emotion = "+i),a([o,i])):(console.log("NO FACES FOUND"),n())})).catch((function(){n()}))}))}},{key:"getMusicYearFromAge",value:function(e){if(e<0)return e;var t=(new Date).getFullYear()-e+10,a=t%10,n=t-a;return a>=5&&(n+=10),n<1950?n=1950:n>2010&&(n=2010),n}},{key:"isThisEmotionHappy",value:function(e){if(null==e)return console.log("emotion was null"),console.log(e),!0;var t=e.happiness,a=e.sadness;return console.log("happy:"+t),console.log("sad:"+a),!(a>t)}},{key:"getPlaylistFromParams",value:function(e,t){switch(e){case 1950:return t?"PLNDhBcjuPp0-UCSML4DxFqqc5WN4aGcW1":"PLjLPKGJvC8TuhpLXMhskQUaC26zSBjCsM";case 1960:return t?"PLPKXtd2AJvNkaZgrb0yK3UoQk7487TceH":"PLAZH8pP5KBzXiSfcH_2GgoDeXjtTUF3sM";case 1970:return t?"PL9QL1AvNabH5u2gfi48VogStrPUY_LijY":"PLjyiHjKMhSuK-rChCn2Xl4RNfUcUhx-qA";case 1980:return t?"PL857_Yj5tf8cek2iOFyZBE9XSOLOhW-0m":"PLT_7RtTUm0XwsUHTCuQog7xknmMCuvr4B";case 1990:return t?"PLLWfa8Ng-FdBamt3JCTadmbdd9UtLFZ7K":"PLu1jpc624xfKGhWItKFNRPu7QylkwS-OR";case 2e3:return t?"PLPf_PZG3-WAGq4tgjU6m87Ksndn2Jz2OF":"PLIWqGUaiQxN7kL47fzQ87h0OlTaCyr8-o";case 2010:return t?"RDQMU2NvmEhYGhM":"RDAMVM3AtDnEC4zak";default:return"PL0B2BFACC0574C36F"}}},{key:"getBackgroundImage",value:function(){var e=this.state.emotion.happiness>this.state.emotion.sadness,t=new P("04d08e66c3f35b0d3223494098bf28bb"),a="https://live.staticflickr.com/1732/42648827301_8879542e48_k.jpg",n="city calm";return e&&(n="nature happy"),new Promise((function(e,o){t.photos.search({text:n,safe_search:"1",license:"1,2,3,4,5,6",content_type:"1",extras:"url_l"}).then((function(t){a=t.body.photos.photo[Math.floor(50*Math.random())].url_l,e(a)})).catch((function(){console.error("Error searching flickr photos"),o()}))}))}},{key:"getRecs",value:function(){var e=this.state.age,t=this.state.emotion,a=this.state.opts,n=this.getMusicYearFromAge(e),o=this.isThisEmotionHappy(t);a.playerVars.list=this.getPlaylistFromParams(n,o),a.playerVars.index=Math.floor(10*Math.random()+1),this.setState({opts:a,isHappy:o})}},{key:"render",value:function(){return this.state.loadSong?m.a.createElement("div",{style:{backgroundImage:"url(".concat(this.state.backgroundImage,")"),justifyContent:"center",alignItems:"center",height:"100%",width:"100%"}},m.a.createElement("h3",null,m.a.createElement("strong",null,"Your personalized music selection")),m.a.createElement("br",null),m.a.createElement(d.a,{opts:this.state.opts})):m.a.createElement("div",{className:"App"},this.state.loading?m.a.createElement(y.a,{active:!0,spinner:m.a.createElement(f.a,{sizeUnit:"px",size:100,color:"#36d7b7",loading:!0})},m.a.createElement(v.a,{isFullscreen:!1,dataUri:this.state.dataUri})):m.a.createElement(h.a,{onTakePhotoAnimationDone:this.onTakePhotoAnimationDone}))}}]),a}(m.a.Component);k.defaultProps={emotion:{anger:0,contempt:0,disgust:.001,fear:0,happiness:.989,neutral:.009,sadness:0,surprise:0}},t.a=k}).call(this,a(15).Buffer)}},[[104,1,2]]]);
//# sourceMappingURL=main.79c1e6a4.chunk.js.map